# as found on http://unicorn.bogomips.org/examples/logrotate.conf and heavily modified
/data/accounting_service/shared/log/*.log {
   daily

   # because logs aren't owned by root, we have to do this
   su accounting accounting

   # stick the rotated ones into a subdir (named "old")
   olddir old

   # change name to foo-YYYYMMDD.log
   dateext
   # name the file with yesterday's date, as that's what's in the file
   dateyesterday

   # must use with delaycompress below
   compress
   compresscmd /usr/local/bin/bzip2
   compressext .bz2
   extension   .bz2

   # don't rotate if empty, don't sweat it if the files aren't there
   notifempty
   missingok

   # save 1 year worth of logs
   rotate 365

   # this is important if using "compress" since we need to call
   # the "lastaction" script below before compressing:
   delaycompress

   # note the lack of the evil "copytruncate" option in this
   # config.  Unicorn supports the USR1 signal and we send it
   # as our "lastaction" action:
   #  sharedscripts runs this only once per rotation
   sharedscripts
   lastaction
     upid=/var/groupon/backbeat/shared/pids/unicorn.pid
     test -s $upid && kill -usr1 "$(cat $upid)" || true
     test -x /usr/local/etc/init.d/delayed_job_backbeat && /usr/local/etc/init.d/delayed_job_backbeat restart || true
   endscript
}
