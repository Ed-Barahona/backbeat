# Create mongo backup directory
create_directory '/var/groupon/mongo_backup', 'mongo:mongo'

mongo = host.params['mongodb']

if !mongo.kind_of? Array
  mongo = [mongo]
end

mongo.each_with_index do |x,i|
  mongo_instance_id = i+1

  config = {}
  config.merge! x if x

  # Run logrotate once an hour
  cmd = [
    "1 * * * * /usr/local/bin/lockrun  /usr/local/bin/mongo_backup --port #{config[:port]} --mongoid #{mongo_instance_id}",
    ">> /var/groupon/mongo/log/mongo_backup_#{mongo_instance_id} 2>&1"
   ].join ' '
add_cron_job cmd, 'root'
  
end
  

